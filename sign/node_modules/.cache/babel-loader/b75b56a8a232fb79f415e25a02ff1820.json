{"ast":null,"code":"import _regeneratorRuntime from\"/Users/yugo_tokuchi/scripts/blocto-sign-verify/sign/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/yugo_tokuchi/scripts/blocto-sign-verify/sign/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/yugo_tokuchi/scripts/blocto-sign-verify/sign/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _taggedTemplateLiteral from\"/Users/yugo_tokuchi/scripts/blocto-sign-verify/sign/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral\";var _templateObject,_templateObject2;import React,{useState}from\"react\";import*as fcl from\"@onflow/fcl\";import styled from\"styled-components\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var Card=styled.div(_templateObject||(_templateObject=_taggedTemplateLiteral([\"\\n  margin: 10px 5px;\\n  padding: 10px;\\n  border: 1px solid #c0c0c0;\\n  border-radius: 5px;\\n\"])));var Code=styled.pre(_templateObject2||(_templateObject2=_taggedTemplateLiteral([\"\\n  background: #f0f0f0;\\n  border-radius: 5px;\\n  max-height: 150px;\\n  overflow-y: auto;\\n  padding: 5px;\\n\"])));var GetLatestBlock=function GetLatestBlock(){var _useState=useState(\"--\"),_useState2=_slicedToArray(_useState,2),signedMessage=_useState2[0],setSignedMessage=_useState2[1];var _useState3=useState(\"--\"),_useState4=_slicedToArray(_useState3,2),compSignatures=_useState4[0],setCompSignatures=_useState4[1];var _useState5=useState(\"--\"),_useState6=_slicedToArray(_useState5,2),userAddress=_useState6[0],setUserAddress=_useState6[1];var signUserMessage=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(event){var currentTimestamp,hexMessage,compSignatures;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:event.preventDefault();currentTimestamp=String(new Date().getTime());hexMessage=utf8ToHex(currentTimestamp);_context.next=5;return fcl.currentUser().signUserMessage(hexMessage);case 5:compSignatures=_context.sent;window.parent.postMessage({message:\"compSignatures\",value:{signedMessage:currentTimestamp,compSignatures:compSignatures}},\"*\");setSignedMessage(currentTimestamp);setCompSignatures(JSON.stringify(compSignatures));setUserAddress(compSignatures[0].addr);case 10:case\"end\":return _context.stop();}}},_callee);}));return function signUserMessage(_x){return _ref.apply(this,arguments);};}();return/*#__PURE__*/_jsxs(Card,{children:[/*#__PURE__*/_jsx(\"button\",{onClick:signUserMessage,children:\"Sign\"}),/*#__PURE__*/_jsx(\"br\",{}),\"userAddress: \",userAddress,/*#__PURE__*/_jsx(\"br\",{}),\"message: \",signedMessage,/*#__PURE__*/_jsx(\"br\",{}),\"compSignatures: \",compSignatures]});};function utf8ToHex(str){return Array.from(str).map(function(c){return c.charCodeAt(0)<128?c.charCodeAt(0).toString(16):encodeURIComponent(c).replace(/\\%/g,\"\").toLowerCase();}).join(\"\");}function hexToUtf8(hex){return decodeURIComponent(\"%\"+hex.match(/.{1,2}/g).join(\"%\"));}export default GetLatestBlock;","map":{"version":3,"sources":["/Users/yugo_tokuchi/scripts/blocto-sign-verify/sign/src/SignUserMessage.js"],"names":["React","useState","fcl","styled","Card","div","Code","pre","GetLatestBlock","signedMessage","setSignedMessage","compSignatures","setCompSignatures","userAddress","setUserAddress","signUserMessage","event","preventDefault","currentTimestamp","String","Date","getTime","hexMessage","utf8ToHex","currentUser","window","parent","postMessage","message","value","JSON","stringify","addr","str","Array","from","map","c","charCodeAt","toString","encodeURIComponent","replace","toLowerCase","join","hexToUtf8","hex","decodeURIComponent","match"],"mappings":"0tBAAA,MAAOA,CAAAA,KAAP,EAAgBC,QAAhB,KAAgC,OAAhC,CACA,MAAO,GAAKC,CAAAA,GAAZ,KAAqB,aAArB,CACA,MAAOC,CAAAA,MAAP,KAAmB,mBAAnB,C,wFAEA,GAAMC,CAAAA,IAAI,CAAGD,MAAM,CAACE,GAAV,+JAAV,CAOA,GAAMC,CAAAA,IAAI,CAAGH,MAAM,CAACI,GAAV,gLAAV,CAQA,GAAMC,CAAAA,cAAc,CAAG,QAAjBA,CAAAA,cAAiB,EAAM,eACeP,QAAQ,CAAC,IAAD,CADvB,wCACpBQ,aADoB,eACLC,gBADK,8BAEiBT,QAAQ,CAAC,IAAD,CAFzB,yCAEpBU,cAFoB,eAEJC,iBAFI,8BAGWX,QAAQ,CAAC,IAAD,CAHnB,yCAGpBY,WAHoB,eAGPC,cAHO,eAK3B,GAAMC,CAAAA,eAAe,0FAAG,iBAAOC,KAAP,iKACtBA,KAAK,CAACC,cAAN,GACMC,gBAFgB,CAEGC,MAAM,CAAC,GAAIC,CAAAA,IAAJ,GAAWC,OAAX,EAAD,CAFT,CAGhBC,UAHgB,CAGHC,SAAS,CAACL,gBAAD,CAHN,uBAIOhB,CAAAA,GAAG,CAACsB,WAAJ,GAAkBT,eAAlB,CAAkCO,UAAlC,CAJP,QAIhBX,cAJgB,eAKtBc,MAAM,CAACC,MAAP,CAAcC,WAAd,CACE,CACEC,OAAO,CAAE,gBADX,CAEEC,KAAK,CAAE,CACLpB,aAAa,CAAES,gBADV,CAELP,cAAc,CAAEA,cAFX,CAFT,CADF,CAQE,GARF,EAUAD,gBAAgB,CAACQ,gBAAD,CAAhB,CACAN,iBAAiB,CAACkB,IAAI,CAACC,SAAL,CAAepB,cAAf,CAAD,CAAjB,CACAG,cAAc,CAACH,cAAc,CAAC,CAAD,CAAd,CAAkBqB,IAAnB,CAAd,CAjBsB,uDAAH,kBAAfjB,CAAAA,eAAe,4CAArB,CAoBA,mBACE,MAAC,IAAD,yBACE,eAAQ,OAAO,CAAEA,eAAjB,kBADF,cAEE,aAFF,iBAGgBF,WAHhB,cAIE,aAJF,aAKYJ,aALZ,cAME,aANF,oBAOmBE,cAPnB,GADF,CAWD,CApCD,CAqCA,QAASY,CAAAA,SAAT,CAAmBU,GAAnB,CAAwB,CACtB,MAAOC,CAAAA,KAAK,CAACC,IAAN,CAAWF,GAAX,EACJG,GADI,CACA,SAACC,CAAD,QACHA,CAAAA,CAAC,CAACC,UAAF,CAAa,CAAb,EAAkB,GAAlB,CACID,CAAC,CAACC,UAAF,CAAa,CAAb,EAAgBC,QAAhB,CAAyB,EAAzB,CADJ,CAEIC,kBAAkB,CAACH,CAAD,CAAlB,CAAsBI,OAAtB,CAA8B,KAA9B,CAAqC,EAArC,EAAyCC,WAAzC,EAHD,EADA,EAMJC,IANI,CAMC,EAND,CAAP,CAOD,CACD,QAASC,CAAAA,SAAT,CAAmBC,GAAnB,CAAwB,CACtB,MAAOC,CAAAA,kBAAkB,CAAC,IAAMD,GAAG,CAACE,KAAJ,CAAU,SAAV,EAAqBJ,IAArB,CAA0B,GAA1B,CAAP,CAAzB,CACD,CACD,cAAenC,CAAAA,cAAf","sourcesContent":["import React, { useState } from \"react\";\nimport * as fcl from \"@onflow/fcl\";\nimport styled from \"styled-components\";\n\nconst Card = styled.div`\n  margin: 10px 5px;\n  padding: 10px;\n  border: 1px solid #c0c0c0;\n  border-radius: 5px;\n`;\n\nconst Code = styled.pre`\n  background: #f0f0f0;\n  border-radius: 5px;\n  max-height: 150px;\n  overflow-y: auto;\n  padding: 5px;\n`;\n\nconst GetLatestBlock = () => {\n  const [signedMessage, setSignedMessage] = useState(\"--\");\n  const [compSignatures, setCompSignatures] = useState(\"--\");\n  const [userAddress, setUserAddress] = useState(\"--\");\n\n  const signUserMessage = async (event) => {\n    event.preventDefault();\n    const currentTimestamp = String(new Date().getTime());\n    const hexMessage = utf8ToHex(currentTimestamp);\n    const compSignatures = await fcl.currentUser().signUserMessage(hexMessage);\n    window.parent.postMessage(\n      {\n        message: \"compSignatures\",\n        value: {\n          signedMessage: currentTimestamp,\n          compSignatures: compSignatures,\n        },\n      },\n      \"*\"\n    );\n    setSignedMessage(currentTimestamp);\n    setCompSignatures(JSON.stringify(compSignatures));\n    setUserAddress(compSignatures[0].addr);\n  };\n\n  return (\n    <Card>\n      <button onClick={signUserMessage}>Sign</button>\n      <br />\n      userAddress: {userAddress}\n      <br />\n      message: {signedMessage}\n      <br />\n      compSignatures: {compSignatures}\n    </Card>\n  );\n};\nfunction utf8ToHex(str) {\n  return Array.from(str)\n    .map((c) =>\n      c.charCodeAt(0) < 128\n        ? c.charCodeAt(0).toString(16)\n        : encodeURIComponent(c).replace(/\\%/g, \"\").toLowerCase()\n    )\n    .join(\"\");\n}\nfunction hexToUtf8(hex) {\n  return decodeURIComponent(\"%\" + hex.match(/.{1,2}/g).join(\"%\"));\n}\nexport default GetLatestBlock;\n"]},"metadata":{},"sourceType":"module"}