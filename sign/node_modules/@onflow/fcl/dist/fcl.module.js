import*as e from"@onflow/sdk";import{config as r,send as t,getTransactionStatus as n,decode as o,resolve as i,createSignableVoucher as s,pipe as a,interaction as u,latestBlock as c}from"@onflow/sdk";export{TestUtils,account,arg,args,atBlockHeight,atBlockId,authorization,authorizations,build,config,createSignableVoucher,decode,getAccount,getBlock,getBlockByHeight,getBlockById,getBlockHeader,getCollection,getEvents,getEventsAtBlockHeightRange,getEventsAtBlockIds,getLatestBlock,getTransaction,getTransactionStatus,invariant,isBad,isOk,latestBlock,limit,param,params,payer,ping,pipe,proposer,ref,script,send,transaction,validator,why}from"@onflow/sdk";import{invariant as l}from"@onflow/util-invariant";import*as d from"@onflow/types";import{INIT as f,SUBSCRIBE as h,UNSUBSCRIBE as m,spawn as p,send as v,UPDATED as y,SNAPSHOT as g,subscriber as P,snapshoter as E}from"@onflow/util-actor";import{withPrefix as b,sansPrefix as S}from"@onflow/util-address";export{display,sansPrefix,withPrefix}from"@onflow/util-address";import*as w from"@onflow/rlp";import{uid as A}from"@onflow/util-uid";export{template as cadence,template as cdc}from"@onflow/util-template";r().put("accessNode.api","http://localhost:8080").put("challenge.handshake","http://localhost:8700/authenticate");var R="0.0.74",I=function(e){return function(r){return typeof r===e}},k=function(e){return null!=e},j=I("object"),C=I("string"),T=I("function"),O=I("number");function N(r){return T(r)?r(e.arg,d):[]}var x=function(r){void 0===r&&(r={});try{return Promise.resolve(function(e){try{return l(k(e.cadence),"query({ cadence }) -- cadence is required"),l(C(e.cadence),"query({ cadence }) -- cadence must be a string"),Promise.resolve()}catch(e){return Promise.reject(e)}}(r)).then(function(){return e.send([e.script(r.cadence),e.args(N(r.args||[])),r.limit&&"number"==typeof r.limit&&e.limit(r.limit)]).then(e.decode)})}catch(e){return Promise.reject(e)}};function L(){return(L=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e}).apply(this,arguments)}function D(e,r){(null==r||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function _(e,r){var t="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(t)return(t=t.call(e)).next.bind(t);if(Array.isArray(e)||(t=function(e,r){if(e){if("string"==typeof e)return D(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?D(e,r):void 0}}(e))||r&&e&&"number"==typeof e.length){t&&(e=t);var n=0;return function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var U={f_type:"Service",f_vsn:"1.0.0"},z={f_type:"Identity",f_vsn:"1.0.0"},F={f_type:"USER",f_vsn:"1.0.0"},H={f_type:"PollingResponse",f_vsn:"1.0.0"},B={f_type:"CompositeSignature",f_vsn:"1.0.0"};function M(e){if(null==e)return null;switch(e.f_vsn){case"1.0.0":return e;default:return L({old:e},U,{type:"frame",endpoint:e.endpoint,params:e.params||{},data:e.data||{}})}}function J(e){if(null==e)return null;switch(e.f_vsn){case"1.0.0":return e;default:return L({},U,{type:"back-channel-rpc",endpoint:e.endpoint,method:e.method,params:e.params||{},data:e.data||{}})}}var K={"back-channel-rpc":J,"pre-authz":function(e){if(null==e)return null;switch(e.f_vsn){case"1.0.0":return e;default:return L({},U,{type:e.type,uid:e.id,endpoint:e.endpoint,method:e.method,identity:L({},z,{address:b(e.addr),keyId:e.keyId}),params:e.params,data:e.data})}},authz:function(e){if(null==e)return null;switch(e.f_vsn){case"1.0.0":return e;default:return L({},U,{type:e.type,uid:e.id,endpoint:e.endpoint,method:e.method,identity:L({},z,{address:b(e.addr),keyId:e.keyId}),params:e.params,data:e.data})}},authn:function(e){if(null==e)return null;switch(e.f_vsn){case"1.0.0":return e;default:return L({},U,{type:e.type,uid:e.id,endpoint:e.authn,id:e.pid,provider:{address:b(e.addr),name:e.name,icon:e.icon}})}},frame:M,"open-id":function(e){if(null==e)return null;switch(e.f_vsn){case"1.0.0":return e;default:return null}},"user-signature":function(e){if(null==e)return null;switch(e.f_vsn){case"1.0.0":return e;default:throw new Error("Invalid user-signature service")}}};function q(e){return w.encode([e.provider.address||e.provider.name||"UNSPECIFIED",e.id]).toString("hex")}function G(e,r){return void 0===e&&(e=[]),e.find(function(e){return e.type===r})}function V(e){var r=new URL(e.endpoint);if(r.searchParams.append("l6n",window.location.origin),null!=e.params)for(var t=0,n=Object.entries(e.params||{});t<n.length;t++){var o=n[t];r.searchParams.append(o[0],o[1])}return r}function Y(e,r){void 0===r&&(r={});var t=r.method||"POST",n="GET"===t?void 0:JSON.stringify(r.data||e.data||{});return fetch(V(e),{method:t,headers:L({},e.headers||{},r.headers||{},{"Content-Type":"application/json"}),body:n}).then(function(e){return e.json()})}function Z(e){if(null==e)return null;switch(e.f_vsn){case"1.0.0":return e;default:return L({},H,{status:e.status,reason:e.reason,data:e.compositeSignature||e.data||{},updates:J(e.authorizationUpdates),local:M((e.local||[])[0])})}}var $="FCL_IFRAME",W=function(){},X=new Set(["monetizationstart","monetizationpending","monetizationprogress","monetizationstop"]);function Q(e,r){if(void 0===r&&(r={}),null==e)return{send:W,close:W};var t=r.onClose||W,n=r.onMessage||W,o=r.onReady||W,i=r.onResponse||W;window.addEventListener("message",c);var s=function(e){l(!document.getElementById($),"Attempt at triggering multiple Frames",{src:e});var r=document.createElement("iframe");return r.src=e,r.id=$,r.allow="usb *; hid *",r.frameBorder="0",r.style.cssText="\n  position:fixed;\n  top: 0px;\n  right: 0px;\n  bottom: 0px;\n  left: 0px;\n  height: 100vh;\n  width: 100vw;\n  display:block;\n  background:rgba(0,0,0,0.25);\n  z-index: 2147483647;\n  box-sizing: border-box;\n",document.body.append(r),[r,function(){document.getElementById($)&&document.getElementById($).remove()}]}(V(e)),a=s[0],u=s[1];return{send:f,close:d};function c(e){try{if("object"!=typeof e.data)return;if(X.has(e.data.type))return;"FCL:FRAME:CLOSE"===e.data.type&&d(),"FCL:FRAME:READY"===e.data.type&&o(e,{send:f,close:d}),"FCL:FRAME:RESPONSE"===e.data.type&&i(e,{send:f,close:d}),n(e,{send:f,close:d}),"FCL::CHALLENGE::RESPONSE"===e.data.type&&i(e,{send:f,close:d}),"FCL::AUTHZ_READY"===e.data.type&&o(e,{send:f,close:d}),"FCL::CHALLENGE::CANCEL"===e.data.type&&d(),"FCL::CANCEL"===e.data.type&&d()}catch(e){console.error("Frame Callback Error",e),d()}}function d(){try{window.removeEventListener("message",c),u(),t()}catch(e){console.error("Frame Close Error",e)}}function f(e){try{a.contentWindow.postMessage(JSON.parse(JSON.stringify(e||{})),"*")}catch(r){console.error("Frame Send Error",e,r)}}}var ee,re=function e(r,t){void 0===t&&(t=function(){return!0});try{if(l(r,"Missing Polling Service",{service:r}),!t())throw new Error("Externally Halted");return Promise.resolve(Y(r,{method:ne(r)}).then(Z)).then(function(r){switch(r.status){case"APPROVED":return r.data;case"DECLINED":throw new Error("Declined: "+(r.reason||"No reason supplied."));default:return Promise.resolve(new Promise(function(e){return setTimeout(e,500)})).then(function(){return e(r.updates,t)})}})}catch(e){return Promise.reject(e)}},te={"HTTP/GET":"GET","HTTP/POST":"POST"},ne=function(e){return l(te[e.method],"Invalid Service Method for type back-channel-rpc",{service:e}),te[e.method]},oe=function(e,r,t){try{return r.data=e.data,Promise.resolve(Y(e,{data:r}).then(Z)).then(function(r){if("APPROVED"===r.status)return r.data;if("DECLINED"===r.status)throw new Error("Declined: "+(r.reason||"No reason supplied."));if("PENDING"===r.status){var t=!0,n=Q(r.local,{onClose:function(){t=!1}}).close;return re(r.updates,function(){return t}).then(function(e){return n(),e}).catch(function(e){throw console.error(e),n(),e})}throw console.error("Auto Decline: Invalid Response",{service:e,resp:r}),new Error("Auto Decline: Invalid Response")})}catch(e){return Promise.reject(e)}},ie=function(e,r,t){void 0===t&&(t={});try{try{return Promise.resolve(se[e.method](e,r,t))}catch(n){throw console.error("execService(service, msg)",n,{service:e,msg:r,opts:t}),n}}catch(e){return Promise.reject(e)}},se={"HTTP/RPC":oe,"HTTP/POST":oe,"IFRAME/RPC":function(e,r,t){return new Promise(function(n,o){var i=A(),s=t.includeOlderJsonRpcCall;r.data=e.data,Q(e,{onReady:function(t,n){var o=n.send;try{o({type:"FCL:FRAME:READY:RESPONSE",body:r,service:{params:e.params,data:e.data}}),s&&o({jsonrpc:"2.0",id:i,method:"fcl:sign",params:[r,e.params]})}catch(e){throw e}},onResponse:function(e,r){var t=r.close;try{if("object"!=typeof e.data)return;var i=Z(e.data);switch(i.status){case"APPROVED":n(i.data),t();break;case"DECLINED":o("Declined: "+(i.reason||"No reason supplied")),t();break;default:o("Declined: No reason supplied"),t()}}catch(e){throw console.error("execIframeRPC onResponse error",e),e}},onMessage:function(e,r){var t=r.close;try{if("object"!=typeof e.data)return;if("2.0"!==e.data.jsonrpc)return;if(e.data.id!==i)return;var s=Z(e.data.result);switch(s.status){case"APPROVED":n(s.data),t();break;case"DECLINED":o("Declined: "+(s.reason||"No reason supplied")),t();break;default:o("Declined: No reason supplied"),t()}}catch(e){throw console.error("execIframeRPC onMessage error",e),e}},onClose:function(){o("Declined: Externally Halted")}})})}};function ae(e){if(null==e)return null;switch(e.f_vsn){case"1.0.0":return e;default:return L({},B,{addr:S(e.addr||e.address),signature:e.signature||e.sig,keyId:e.keyId})}}function ue(e,r,t){if(!e.s){if(t instanceof he){if(!t.s)return void(t.o=ue.bind(null,e,r));1&r&&(r=t.s),t=t.v}if(t&&t.then)return void t.then(ue.bind(null,e,r),ue.bind(null,e,2));e.s=r,e.v=t;var n=e.o;n&&n(e)}}function ce(e,r){try{var t=e()}catch(e){return r(e)}return t&&t.then?t.then(void 0,r):t}var le=function(e,r){try{l(/^[0-9a-f]+$/i.test(e),"Message must be a hex string"),l(Array.isArray(r),"Must include an Array of composite signatures");var t=[],n=[],o=[];return Promise.resolve(Promise.all(r.map(function(e){try{return l("string"==typeof e.addr,"addr must be a string"),l("number"==typeof e.keyId,"keyId must be a number"),l("string"==typeof e.signature,"signature must be a string"),Promise.resolve(ce(function(){return Promise.resolve(fcl.account(e.addr)).then(function(r){return t.push(r.keys[e.keyId].weight.toFixed(1)),n.push(r.keys[e.keyId].signAlgo),o.push(e.signature),r.keys[e.keyId].publicKey})},function(e){throw e}))}catch(e){return Promise.reject(e)}}))).then(function(r){return Promise.resolve(fcl.query({cadence:""+Ne,args:function(i,s){return[i(e,s.String),i(r,s.Array([s.String])),i(t,s.Array(s.UFix64)),i(n,s.Array([s.UInt])),i(o,s.Array([s.String]))]}}))})}catch(e){return Promise.reject(e)}},de=function(e,r){void 0===r&&(r={});try{return Ae(),Promise.resolve(pe(r)).then(function(r){var t=G(r.services,"user-signature");return l(t,"Current user must have authorized a signing service."),ce(function(){return Promise.resolve(ie(t,Oe(e))).then(function(e){return Array.isArray(e)?e.map(function(e){return ae(e)}):[ae(e)]})},function(e){return e})})}catch(e){return Promise.reject(e)}},fe=function(e){try{return Ae(),Promise.resolve(pe()).then(function(r){var t=G(r.services,"authz"),n=G(r.services,"pre-authz");return L({},e,n?{tempId:"CURRENT_USER",resolve:function(e,r){try{return Promise.resolve(ie(n,r)).then(ke)}catch(e){return Promise.reject(e)}}}:{tempId:"CURRENT_USER",resolve:null,addr:S(t.identity.address),keyId:t.identity.keyId,sequenceNum:null,signature:null,signingFunction:function(e){try{return Promise.resolve(ie(t,e,{includeOlderJsonRpcCall:!0})).then(ae)}catch(e){return Promise.reject(e)}}})})}catch(e){return Promise.reject(e)}},he=function(){function e(){}return e.prototype.then=function(r,t){var n=new e,o=this.s;if(o){var i=1&o?r:t;if(i){try{ue(n,1,i(this.v))}catch(e){ue(n,2,e)}return n}return this}return this.o=function(e){try{var o=e.v;1&e.s?ue(n,1,r?r(o):o):t?ue(n,1,t(o)):ue(n,2,o)}catch(e){ue(n,2,e)}},n},e}();function me(e){return e instanceof he&&1&e.s}var pe=function(e){void 0===e&&(e={});try{return Promise.resolve(new Promise(function(t,n){try{return Ae(),Promise.resolve(Ce()).then(function(n){if(n.loggedIn&&Re(n))return t(n);var o=e.serviceStrategy||Q;return Promise.resolve(r.first(["discovery.wallet","challenge.handshake"])).then(function(e){o({endpoint:e},{onReady:function(e,r){var t=r.send;try{return Promise.resolve(ve(/^service\./)).then(function(e){return Promise.resolve(ve(/^app\.detail\./)).then(function(r){t({type:"FCL:AUTHN:CONFIG",services:e,app:r})})})}catch(e){return Promise.reject(e)}},onClose:function(){try{return Promise.resolve(Ce()).then(function(e){t(e)})}catch(e){return Promise.reject(e)}},onResponse:function(e,r){var n=r.close;try{return Promise.resolve(function(e){try{var r=(e=function(e){return e.addr=e.addr?b(e.addr):null,e.paddr=e.paddr?b(e.paddr):null,e}(e)).services||[];return Promise.resolve(function(e,r){try{if(null==e||null==r)return Promise.resolve([]);var t=new URL(e);return t.searchParams.append("code",r),Promise.resolve(fetch(t,{method:"GET",headers:{"Content-Type":"application/json"}}).then(function(e){return e.json()})).then(function(e){if(Array.isArray(e))return e;var r=[];if(Array.isArray(e.authorizations))for(var t,n=_(e.authorizations);!(t=n()).done;)r.push(L({type:"authz",keyId:e.keyId},t.value));return null!=e.provider&&r.push(L({type:"authn",id:"wallet-provider#authn"},e.provider)),r})}catch(e){return Promise.reject(e)}}(e.hks,e.code)).then(function(t){var n,o,i=(n=r,o=t,void 0===n&&(n=[]),void 0===o&&(o=[]),[].concat(n,o)).map(function(r){return function(e,r){try{return K[e.type](e,r)}catch(r){return console.error("Unrecognized FCL Service Type ["+e.type+"]",e,r),e}}(r,e)}),s=function(e,r){return r.find(function(e){return"authn"===e.type})}(0,i);return L({},F,{addr:b(e.addr),cid:q(s),loggedIn:!0,services:i,expiresAt:e.exp})})}catch(e){return Promise.reject(e)}}(e.data)).then(function(e){return v(ye,Pe,e),Promise.resolve(Ce()).then(function(e){t(e),n()})})}catch(e){return Promise.reject(e)}}})})})}catch(e){return Promise.reject(e)}}))}catch(e){return Promise.reject(e)}},ve=function(e){try{return Promise.resolve(r().where(e)).then(function(r){return Object.fromEntries(Object.entries(r).map(function(r){var t=r[1];return[r[0].replace(e,""),t]}))})}catch(e){return Promise.reject(e)}},ye="CURRENT_USER",ge="CURRENT_USER/UPDATED",Pe="SET_CURRENT_USER",Ee='{\n  "f_type": "User",\n  "f_vsn": "1.0.0",\n  "addr":null,\n  "cid":null,\n  "loggedIn":null,\n  "expiresAt":null,\n  "services":[]\n}',be=function(e){try{return sessionStorage.setItem(ye,JSON.stringify(e)),Promise.resolve(e)}catch(e){return Promise.reject(e)}},Se=function(){return r().get("persistSession",!0)},we=((ee={})[f]=function(e){try{return e.merge(JSON.parse(Ee)),Promise.resolve(Se()).then(function(r){var t=function(){if(r)return Promise.resolve(function(){try{var e=JSON.parse(Ee),r=JSON.parse(sessionStorage.getItem(ye));return null!=r&&e.f_vsn!==r.f_vsn?(sessionStorage.removeItem(ye),Promise.resolve(e)):Promise.resolve(r||e)}catch(e){return Promise.reject(e)}}()).then(function(r){Re(r)&&e.merge(r)})}();if(t&&t.then)return t.then(function(){})})}catch(e){return Promise.reject(e)}},ee[h]=function(e,r){e.subscribe(r.from),e.send(r.from,ge,L({},e.all()))},ee[m]=function(e,r){e.unsubscribe(r.from)},ee.SNAPSHOT=function(e,r){try{return r.reply(L({},e.all())),Promise.resolve()}catch(e){return Promise.reject(e)}},ee[Pe]=function(e,r,t){try{return e.merge(t),Promise.resolve(Se()).then(function(r){r&&be(e.all()),e.broadcast(ge,L({},e.all()))})}catch(e){return Promise.reject(e)}},ee.DEL_CURRENT_USER=function(e,r){try{return e.merge(JSON.parse(Ee)),Promise.resolve(Se()).then(function(r){r&&be(e.all()),e.broadcast(ge,L({},e.all()))})}catch(e){return Promise.reject(e)}},ee),Ae=function(){return p(we,ye)};function Re(e){return null==e.expiresAt||0===e.expiresAt||e.expiresAt>Date.now()}function Ie(){Ae(),v(ye,"DEL_CURRENT_USER")}function ke(e){var r=function(e){return{f_type:"PreAuthzResponse",f_vsn:"1.0.0",proposer:(e||{}).proposer,payer:(e||{}).payer||[],authorization:(e||{}).authorization||[]}}(e),t=[];null!=r.proposer&&t.push(["PROPOSER",r.proposer]);for(var n,o=_(r.payer||[]);!(n=o()).done;)t.push(["PAYER",n.value]);for(var i,s=_(r.authorization||[]);!(i=s()).done;)t.push(["AUTHORIZER",i.value]);return t.map(function(e){var r=e[0],t=e[1];return{tempId:[t.identity.address,t.identity.keyId].join("|"),addr:t.identity.address,keyId:t.identity.keyId,signingFunction:function(e){return ie(t,e)},role:{proposer:"PROPOSER"===r,payer:"PAYER"===r,authorizer:"AUTHORIZER"===r}}})}function je(e){Ae();var r="@EXIT",t=p(function(t){try{var n;return t.send(ye,h),Promise.resolve(function(e,r,t){for(var n;;){var o=e();if(me(o)&&(o=o.v),!o)return i;if(o.then){n=0;break}var i=t();if(i&&i.then){if(!me(i)){n=1;break}i=i.s}}var s=new he,a=ue.bind(null,s,2);return(0===n?o.then(c):1===n?i.then(u):(void 0).then(function(){(o=e())?o.then?o.then(c).then(void 0,a):c(o):ue(s,1,i)})).then(void 0,a),s;function u(r){i=r;do{if(!(o=e())||me(o)&&!o.v)return void ue(s,1,i);if(o.then)return void o.then(c).then(void 0,a);me(i=t())&&(i=i.v)}while(!i||!i.then);i.then(u).then(void 0,a)}function c(e){e?(i=t())&&i.then?i.then(u).then(void 0,a):u(i):ue(s,1,i)}}(function(){return!n&&1},0,function(){return Promise.resolve(t.receive()).then(function(o){if(o.tag===r)return t.send(ye,m),void(n=1);e(o.data)})}))}catch(e){return Promise.reject(e)}});return function(){return v(t,r)}}function Ce(){return Ae(),v(ye,"SNAPSHOT",null,{expectReply:!0,timeout:0})}var Te,Oe=function(e){return l(/^[0-9a-f]+$/i.test(e),"Message must be a hex string"),{message:e}},Ne="\nimport Crypto\n    \npub fun main(\n  message: String,\n  rawPublicKeys: [String],\n  weights: [UFix64],\n  signAlgos: [UInt],\n  signatures: [String],\n): Bool {\n\n  let keyList = Crypto.KeyList()\n  \n  var i = 0\n  for rawPublicKey in rawPublicKeys {\n    keyList.add(\n      PublicKey(\n        publicKey: rawPublicKey.decodeHex(),\n        signatureAlgorithm: signAlgos[i] == 2 ? SignatureAlgorithm.ECDSA_P256 : SignatureAlgorithm.ECDSA_secp256k1 \n      ),\n      hashAlgorithm: HashAlgorithm.SHA3_256,\n      weight: weights[i],\n    )\n    i = i + 1\n  }\n\n  let signatureSet: [Crypto.KeyListSignature] = []\n\n  var j = 0\n  for signature in signatures {\n    signatureSet.append(\n      Crypto.KeyListSignature(\n        keyIndex: j,\n        signature: signature.decodeHex()\n      )\n    )\n    j = j + 1\n  }\n    \n  let signedData = message.decodeHex()\n  \n  return keyList.verify(\n    signatureSet: signatureSet,\n    signedData: signedData\n  )\n}\n",xe=function(){return{authenticate:pe,unauthenticate:Ie,authorization:fe,signUserMessage:de,verifyUserSignatures:le,subscribe:je,snapshot:Ce}},Le=function(e){try{return Promise.resolve(t([n(e)]).then(o))}catch(e){return Promise.reject(e)}},De=function(e){return e.status>=4},_e=function(e){return e.status>=3},Ue=function(e){return e.status>=2},ze=((Te={})[f]=function(e){try{return Promise.resolve(Le(e.self())).then(function(r){De(r)||setTimeout(function(){return e.sendSelf("POLL")},2500),e.merge(r)})}catch(e){return Promise.reject(e)}},Te[h]=function(e,r){e.subscribe(r.from),e.send(r.from,y,e.all())},Te[m]=function(e,r){e.unsubscribe(r.from)},Te[g]=function(e,r){try{return r.reply(e.all()),Promise.resolve()}catch(e){return Promise.reject(e)}},Te.POLL=function(e){try{return Promise.resolve(Le(e.self())).then(function(r){var t,n;De(r)||setTimeout(function(){return e.sendSelf("POLL")},2500),t=e.all(),n=r,JSON.stringify(t)!==JSON.stringify(n)&&e.broadcast(y,r),e.merge(r)})}catch(e){return Promise.reject(e)}},Te),Fe=function(e){if("object"==typeof e&&(e=e.transactionId),null==e)throw new Error("transactionId required");return e},He=function(e){return p(ze,Fe(e))};function Be(e){function r(r){return P(Fe(e),He,r)}function t(e){return function(t){void 0===t&&(t={});var n=t.suppress||!1;return new Promise(function(t,o){var i=r(function(r){r.statusCode&&!n?(o(r.errorMessage),i()):e(r)&&(t(r),i())})})}}return{snapshot:function(){return E(e,He)},subscribe:r,onceFinalized:t(Ue),onceExecuted:t(_e),onceSealed:t(De)}}Be.isUnknown=function(e){return e.status>=0},Be.isPending=function(e){return e.status>=1},Be.isFinalized=Ue,Be.isExecuted=_e,Be.isSealed=De,Be.isExpired=function(e){return 5===e.status};var Me,Je=function(r){void 0===r&&(r={});try{return Promise.resolve(function(t,n){try{var o=Promise.resolve(function(e){try{return l(k(e),"mutate(opts) -- opts is required"),l(j(e),"mutate(opts) -- opts must be an object"),l(k(e.cadence),"mutate({ cadence }) -- cadence is required"),l(C(e.cadence),"mutate({ cadence }) -- cadence must be a string"),Promise.resolve()}catch(e){return Promise.reject(e)}}(r)).then(function(){return Promise.resolve(e.config().get("fcl.authz",xe().authorization)).then(function(t){return e.send([e.transaction(r.cadence),e.args(N(r.args||[])),r.limit&&O(r.limit)&&e.limit(r.limit),e.proposer(r.proposer||r.authz||t),e.payer(r.payer||r.authz||t),e.authorizations(r.authorizations||[r.authz||t])]).then(e.decode)})})}catch(e){return n(e)}return o&&o.then?o.then(void 0,n):o}(0,function(e){throw e}))}catch(e){return Promise.reject(e)}},Ke=function(e,t){void 0===e&&(e=[]),void 0===t&&(t={});try{return Promise.resolve(r.first(["sdk.resolve"],t.resolve||i)).then(function(r){function t(){return Promise.resolve(r(e)).then(function(e){return JSON.stringify(s(e),null,2)})}var n=function(){if(Array.isArray(e))return Promise.resolve(a(u(),e)).then(function(r){e=r})}();return n&&n.then?n.then(t):t()})}catch(e){return Promise.reject(e)}},qe=function(e){try{var t=setTimeout;return Promise.resolve(r().get("fcl.eventPollRate",1e4)).then(function(r){return t(function(){return e.sendSelf("TICK")},r)})}catch(e){return Promise.reject(e)}},Ge=((Me={}).TICK=function(e){try{if(!e.hasSubs())return Promise.resolve();var r=e.get("hwm"),n=function(){if(null==r){var n=e.put;return Promise.resolve(c()).then(function(r){n.call(e,"hwm",r);var t=e.put;return Promise.resolve(qe(e)).then(function(r){t.call(e,"tick",r)})})}return Promise.resolve(c()).then(function(n){return e.put("hwm",n),Promise.resolve(t([getEvents(e.self(),r.height,n.height-1)]).then(o)).then(function(r){for(var t,n=_(r);!(t=n()).done;)e.broadcast("UPDATED",t.value.data);var o=e.put;return Promise.resolve(qe(e)).then(function(r){o.call(e,"tick",r)})})})}();return Promise.resolve(n&&n.then?n.then(function(){}):void 0)}catch(e){return Promise.reject(e)}},Me[h]=function(e,r){try{var t=function(){e.subscribe(r.from)},n=function(){if(!e.hasSubs()){var r=e.put;return Promise.resolve(qe(e)).then(function(t){r.call(e,"tick",t)})}}();return Promise.resolve(n&&n.then?n.then(t):t())}catch(e){return Promise.reject(e)}},Me[m]=function(e,r){e.unsubscribe(r.from),e.hasSubs()||(clearTimeout(e.get("tick")),e.delete("tick"),e.delete("hwm"))},Me),Ve=function(e){return p(Ge,e)};function Ye(e){return{subscribe:function(r){return P(e,Ve,r)}}}var Ze=function(e){return xe().authenticate(e)},$e=function(){return xe().unauthenticate()},We=function(){return xe().unauthenticate(),xe().authenticate()},Xe=function(e){return xe().authenticate()},Qe=function(e){return xe().authenticate()},er=xe().authorization,rr=d;export{R as VERSION,Ze as authenticate,er as authz,xe as currentUser,Ye as events,Qe as logIn,Je as mutate,x as query,We as reauthenticate,Ke as serialize,Xe as signUp,rr as t,Be as tx,$e as unauthenticate};
//# sourceMappingURL=fcl.module.js.map
